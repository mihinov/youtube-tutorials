function e(e,t,s,o){Object.defineProperty(e,t,{get:s,set:o,enumerable:!0,configurable:!0})}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},s={},o={},i=t.parcelRequiree4b2;function n(e,t=0){const s={id:0};let o=Date.now();const i=()=>{if(0===t)return e(),void(s.id=requestAnimationFrame(i));const n=Date.now(),p=n-o;p>=t&&(e(),o=n-p%t),s.id=requestAnimationFrame(i)};return s.id=requestAnimationFrame(i),s}function p(e,t,s){let o=parseInt(e.value);return isNaN(o)||o<t?o=t:o>s&&(o=s),e.value=o.toString(),o}null==i&&((i=function(e){if(e in s)return s[e].exports;if(e in o){var t=o[e];delete o[e];var i={id:e,exports:{}};return s[e]=i,t.call(i.exports,i,i.exports),i.exports}var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}).register=function(e,t){o[e]=t},t.parcelRequiree4b2=i),i.register("27Lyk",(function(t,s){var o,i;e(t.exports,"register",(()=>o),(e=>o=e)),e(t.exports,"resolve",(()=>i),(e=>i=e));var n={};o=function(e){for(var t=Object.keys(e),s=0;s<t.length;s++)n[t[s]]=e[t[s]]},i=function(e){var t=n[e];if(null==t)throw new Error("Could not resolve bundle with id "+e);return t}})),i("27Lyk").register(JSON.parse('{"8hlSa":"index.5e8e4cae.js","1fGk6":"worker-game-of-life-logic.f17569ed.js"}'));var d,r;r=function(e,t,s){if(t===self.location.origin)return e;var o=s?"import "+JSON.stringify(e)+";":"importScripts("+JSON.stringify(e)+");";return URL.createObjectURL(new Blob([o],{type:"application/javascript"}))};let a=new URL(i("27Lyk").resolve("1fGk6"),import.meta.url);d=r(a.toString(),a.origin,!0);const l=document.querySelector(".canvas"),h=document.querySelector(".popup");if(null===l||null===h)throw new Error("canvas не найден");const u=new class{cycles=0;played=!1;interval=500;gameTime=0;gameStartTime=0;gameLastTime=0;random=!1;speed=0;activeCells=0;localStorageUse=!1;isDragging=!1;isRealDragging=!1;worker=new Worker(d);loading=!1;focusedInput=null;popupHidden=!1;constructor({canvasNode:e,popupNode:t,cellsCountX:s,cellsCountY:o,random:i,speed:n,localStorageUse:p,popupHidden:d}){if(n<1)throw new Error("GameOfLife: speed не может быть меньше 1");if(n>10)throw new Error("GameOfLife: speed не может быть больше 10");this.ctx=e.getContext("2d"),this.rows=s,this.cols=o,this.random=i,this.speed=n,this.localStorageUse=p,this.popupHidden=d,this.initNodes(e,t),this.localStorageUse&&this.useLocalStorage(),this.initCalcSpeed(),this.setCanvasSize(),this.setColorCell(),this.initInputNodes(),this.initPopupHidden(),this.sendWorkerInitFields({random:this.random,rows:this.rows,cols:this.cols}).then((({activeCells:e,field:t,buffer:s})=>{this.initEventListeners(),this.drawField(),this.renderPopup()}))}initInputNodes(){this.nodes.popupInputRowsNode.value=String(this.rows),this.nodes.popupInputColsNode.value=String(this.cols)}initPopupHidden(){this.togglePopup(this.popupHidden)}disableInputs(){this.nodes.popupInputRowsNode.disabled=!0,this.nodes.popupInputColsNode.disabled=!0}enableInputs(){this.nodes.popupInputRowsNode.disabled=!1,this.nodes.popupInputColsNode.disabled=!1,null!==this.focusedInput&&(this.focusedInput.focus(),this.focusedInput=null)}sendWorkerInitFields({random:e,rows:t,cols:s}){this.load(),this.disableInputs(),this.worker.postMessage({type:"initFields",payload:{random:e,rows:t,cols:s}});return new Promise(((e,t)=>{this.worker.onmessage=s=>{const o=s.data;if(this.loadComplete(),this.enableInputs(),"result: initFields"===o.type){const t=o.data,{activeCells:s,field:i,buffer:n}=t;this.activeCells=s,this.field=i,this.buffer=n,e(t)}t(!1)}}))}load(){this.loading=!0,this.nodes.popupLoadNode.classList.add("popup__load_active"),this.nodes.popupNode.classList.add("popup_load")}loadComplete(){this.loading=!1,this.nodes.popupLoadNode.classList.remove("popup__load_active"),this.nodes.popupNode.classList.remove("popup_load")}initEventListeners(){window.addEventListener("resize",this.resizeAndDraw);window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",this.setColorCellAndDraw),this.nodes.popupPauseNode.addEventListener("click",(()=>{!1!==this.played&&this.stopGame()})),this.nodes.popupPlayNode.addEventListener("click",(()=>{!0!==this.played&&this.startGame()})),this.nodes.popupGenerateNode.addEventListener("click",this.generateNewFields),this.nodes.canvasNode.addEventListener("pointerdown",(e=>{if(!0!==this.loading){if(2===e.button||1===e.button)return!1;this.isDragging=!0,this.isRealDragging=!1}})),this.nodes.canvasNode.addEventListener("pointermove",(e=>{if(2===e.button||1===e.button)return!1;!0===this.isDragging&&!1===this.loading&&(this.isRealDragging=!0,this.generateCellByClick(e,!0))})),document.addEventListener("pointerup",(e=>{if(2===e.button||1===e.button)return!1;!0!==this.isClickOnElement(e,this.nodes.popupNode)&&(!1===this.isRealDragging&&!1===this.loading&&this.generateCellByClick(e,!1),this.isDragging=!1,this.isRealDragging=!1)})),this.nodes.popupRandomCheckboxNode.addEventListener("input",(()=>{this.random=!this.random,this.localStorageUse&&this.setLocalStorage("random",this.random),this.renderRandom()})),this.nodes.popupSpeedRangeNode.addEventListener("input",this.calcSpeedInputChange),this.nodes.popupClearNode.addEventListener("click",this.clear),this.nodes.popupStepNode.addEventListener("click",(()=>{this.disableInputs(),this.stepGame()?.then((e=>{this.enableInputs()}))})),this.nodes.popupInputRowsNode.addEventListener("input",(()=>{const e=p(this.nodes.popupInputRowsNode,0,2e3);this.localStorageUse&&this.setLocalStorage("rows",e),this.focusedInput=this.nodes.popupInputRowsNode,this.resizeFieldRows(e)})),this.nodes.popupInputColsNode.addEventListener("input",(()=>{const e=p(this.nodes.popupInputColsNode,0,2e3);this.localStorageUse&&this.setLocalStorage("cols",e),this.focusedInput=this.nodes.popupInputColsNode,this.resizeFieldCols(e)})),this.nodes.popupCloseNode.addEventListener("click",(()=>{this.popupHidden=!this.popupHidden,this.togglePopup(this.popupHidden)}))}togglePopup=e=>{!0===this.localStorageUse&&this.setLocalStorage("popupHidden",this.popupHidden),!0===this.popupHidden?(this.nodes.popupNode.classList.add("popup_hidden"),this.nodes.popupCloseNode.textContent="Открыть"):(this.nodes.popupNode.classList.remove("popup_hidden"),this.nodes.popupCloseNode.textContent="Скрыть")};resizeFieldRows(e){!0!==this.loading&&this.sendWorkerResizeField(e,this.cols,this.random).then((e=>{this.setCanvasSize(),this.drawField(),this.renderTime(),this.renderPopup()}))}resizeFieldCols(e){!0!==this.loading&&this.sendWorkerResizeField(this.rows,e,this.random).then((e=>{this.setCanvasSize(),this.drawField(),this.renderTime(),this.renderPopup()}))}sendWorkerResizeField(e,t,s){this.load(),this.disableInputs(),this.worker.postMessage({type:"resizeField",payload:{newRows:e,newCols:t,random:s}});return new Promise(((e,t)=>{this.worker.onmessage=s=>{const o=s.data;if(this.loadComplete(),this.enableInputs(),"result: resizeField"===o.type){const t=o.data,{field:s,buffer:i,activeCells:n,rows:p,cols:d}=t;this.field=s,this.buffer=i,this.activeCells=n,this.rows=p,this.cols=d,e(t)}t(!1)}})).catch((()=>{}))}isClickOnElement(e,t){let s=e.target;for(;null!=s;){if(s===t)return!0;s=s.parentElement}return!1}sendWorkerDeleteOrCreateCell(e,t){this.load(),this.worker.postMessage({type:"deleteOrCreateCell",payload:{typeAction:e,key:t}});return new Promise(((e,t)=>{this.worker.onmessage=s=>{const o=s.data;if(this.loadComplete(),"result: deleteOrCreateCell"===o.type){const t=o.data;e(t)}t(!1)}}))}generateCellByClick=(e,t=!1)=>{if(!0===this.played)return;const s=this.nodes.canvasNode.getBoundingClientRect(),o=e.clientX-s.left,i=e.clientY-s.top,n=Math.floor(o/this.cellSize),p=Math.floor(i/this.cellSize),d=this.getKey(p,n),r=this.field.get(d),a=()=>{this.activeCells++,this.field.set(d,!0),this.sendWorkerDeleteOrCreateCell("create",d).then()};!1===r&&!0===t||!1===r&&!1===t?a():!0===r&&!1===t&&(()=>{this.activeCells--,this.field.set(d,!1),this.sendWorkerDeleteOrCreateCell("delete",d).then()})(),this.renderPopulation(),this.drawField()};initCalcSpeed(){const e=Number(this.nodes.popupSpeedRangeNode.max),t=Number(this.nodes.popupSpeedRangeNode.min),s=t+(this.speed-1)/9*(e-t);this.nodes.popupSpeedRangeNode.value=String(s),this.nodes.popupSpeedInfoNode.textContent=String(this.speed)}calcSpeedInputChange=()=>{const e=this.played;this.stopGame();const t=this.nodes.popupSpeedRangeNode.valueAsNumber,s=Number(this.nodes.popupSpeedRangeNode.max),o=Number(this.nodes.popupSpeedRangeNode.min),i=Number((9*((t-o)/(s-o))+1).toFixed(1));this.speed=i,this.nodes.popupSpeedInfoNode.textContent=String(this.speed),this.localStorageUse&&this.setLocalStorage("speed",this.speed),!0===e&&this.startGame()};useLocalStorage(){const e=this.getLocalStorage();void 0!==e.random&&(this.random=e.random),void 0!==e.speed&&(this.speed=e.speed),void 0!==e.rows&&(this.rows=e.rows),void 0!==e.cols&&(this.cols=e.cols),void 0!==e.popupHidden&&(this.popupHidden=e.popupHidden)}clear=()=>{this.loading,this.stopGame(),this.gameTime=0,this.gameLastTime=0,this.gameStartTime=0,this.cycles=0,this.disableInputs(),this.sendWorkerInitFields({random:!1,rows:this.rows,cols:this.cols}).then((e=>{this.drawField(),this.renderTime(),this.renderPopup(),this.enableInputs()}))};generateNewFields=()=>{this.loading,this.sendWorkerInitFields({random:!0,rows:this.rows,cols:this.cols}).then((e=>{this.cycles=0,this.drawField(),this.renderPopup()}))};initNodes(e,t){const s=this._querySelector(t,".popup__play"),o=this._querySelector(t,".popup__pause"),i=this._querySelector(t,".popup__time"),n=this._querySelector(t,".popup__population"),p=this._querySelector(t,".popup__cycles"),d=this._querySelector(t,".popup__generate"),r=this._querySelector(document,".wrapper-canvas"),a=this._querySelector(t,".popup__random-checkbox"),l=this._querySelector(t,".popup__speed-range"),h=this._querySelector(t,".popup__speed-info"),u=this._querySelector(t,".popup__clear"),c=this._querySelector(t,".popup__step"),g=this._querySelector(t,".popup__load"),m=this._querySelector(t,".popup__rows"),f=this._querySelector(t,".popup__cols"),w=this._querySelector(t,".popup__close");this.nodes={canvasNode:e,popupNode:t,popupPlayNode:s,popupPauseNode:o,popupTimeNode:i,popupPopulationNode:n,popupCyclesNode:p,popupGenerateNode:d,wrapperCanvasNode:r,popupRandomCheckboxNode:a,popupSpeedRangeNode:l,popupSpeedInfoNode:h,popupClearNode:u,popupStepNode:c,popupLoadNode:g,popupInputRowsNode:m,popupInputColsNode:f,popupCloseNode:w}}_querySelector(e,t){const s=e.querySelector(t);if(null===s)throw new Error(`GameOfLife: элемент с классом ${t} не найден`);return s}resizeAndDraw=()=>{this.setCanvasSize(),this.drawField()};setColorCell=()=>{this.colorCell=getComputedStyle(document.documentElement).getPropertyValue("--color")};setColorCellAndDraw=()=>{this.setColorCell(),this.drawField()};setCanvasSize=()=>{const e=this.nodes.wrapperCanvasNode.offsetWidth,t=this.nodes.wrapperCanvasNode.offsetHeight,s=this.cols/this.rows,o=Math.min(e,t*s),i=o/s;this.cellSize=o/this.cols;const n=(e-o)/2,p=(t-i)/2;this.nodes.canvasNode.width=o,this.nodes.canvasNode.height=i,this.nodes.wrapperCanvasNode.style.padding=`${p}px ${n}px`};getKey(e,t){return`${e}-${t}`}drawField(){this.load(),this.ctx.clearRect(0,0,this.nodes.canvasNode.width,this.nodes.canvasNode.height);const e=this.cellSize;this.ctx.fillStyle=this.colorCell;for(let t=0;t<this.rows;t++)for(let s=0;s<this.cols;s++){const o=this.getKey(t,s);this.field.get(o)&&this.ctx.fillRect(s*e,t*e,e,e)}this.loadComplete()}sendWorkerUpdateField(){this.load(),this.worker.postMessage({type:"updateField",payload:{}});return new Promise(((e,t)=>{this.worker.onmessage=s=>{const o=s.data;if(this.loadComplete(),"result: updateField"===o.type){const t=o.data,{activeCells:s,field:i,buffer:n}=t;this.activeCells=s,this.field=i,this.buffer=n,e(t)}t(!1)}}))}renderPopup(){this.renderPopulation(),this.renderRandom(),this.nodes.popupCyclesNode.textContent=String(this.cycles),this.nodes.popupRandomCheckboxNode.checked=this.random}renderTime(){let e=Date.now()-this.gameStartTime+this.gameLastTime;0===this.gameStartTime&&(e=0),this.gameTime=e,this.nodes.popupTimeNode.textContent=(this.gameTime/1e3).toFixed(1)}renderRandom(){!0===this.random?this.nodes.popupGenerateNode.classList.add("popup__generate_active"):this.nodes.popupGenerateNode.classList.remove("popup__generate_active")}renderPopulation(){this.nodes.popupPopulationNode.textContent=String(this.activeCells)}stepGame=()=>{if(!0!==this.loading)return this.sendWorkerUpdateField().then((e=>(this.drawField(),this.cycles=this.cycles+1,this.renderPopup(),e)))};startGame(){this.disableInputs(),this.played=!0,this.gameStartTime=Date.now(),this.animationObj=n(this.stepGame,this.interval/this.speed**1.5),this.animationTimeId=n(this.stepAnimationRenderTime)}stepAnimationRenderTime=()=>{this.renderTime()};stopGame(){!1!==this.played&&(this.played=!1,this.gameLastTime=this.gameTime,cancelAnimationFrame(this.animationObj.id),cancelAnimationFrame(this.animationTimeId.id),this.enableInputs())}getLocalStorage(){return JSON.parse(localStorage.getItem("life")||"{}")}setLocalStorage(e,t){const s=this.getLocalStorage();s[e]=t,localStorage.setItem("life",JSON.stringify(s))}}({canvasNode:l,cellsCountX:100,cellsCountY:100,popupNode:h,random:!1,speed:1,localStorageUse:!0,popupHidden:!1});window.game=u;
//# sourceMappingURL=index.5e8e4cae.js.map
